<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>All Products - NYRAH</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <link rel="stylesheet" href="/user/product.css">

  <style>
    .offer-badge {
      position: absolute;
      background: red;
      color: #fff;
      padding: 3px 6px;
      font-size: 12px;
      top: 10px;
      left: 10px;
      border-radius: 3px;
    }
    .card {
      position: relative;
      cursor: pointer;
    }
  </style>
</head>
<body>
<%- include('../../views/partials/user/header') %>
<div class="container mt-4">
  <div class="row">
    <div class="col-md-3 sidebar">
      <form method="GET" action="/AllProducts">

        <h4>Filters</h4><br>
        <div class="filter-section mb-3">
          <h6>Sort By <i class="bi bi-chevron-down"></i></h6>
          <div class="filter-options">
            <div><input type="radio" name="sort" value="low-high" <%= selected.sort==='low-high'?'checked':'' %>> Price Low → High</div>
            <div><input type="radio" name="sort" value="high-low" <%= selected.sort==='high-low'?'checked':'' %>> Price High → Low</div>
            <div><input type="radio" name="sort" value="newest" <%= selected.sort==='newest'?'checked':'' %>> Newest</div>
          </div>
        </div>
        <div class="filter-section mb-3">
          <h6>Size <i class="bi bi-chevron-down"></i></h6>
          <div class="filter-options">
            <% ['S','M','L','XL'].forEach(s => { %>
              <div><input type="radio" name="size" value="<%= s %>" <%= selected.size===s?'checked':'' %>> <%= s %></div>
            <% }) %>
          </div>
        </div>

        <div class="filter-section mb-3">
          <h6>Color <i class="bi bi-chevron-down"></i></h6>
          <div class="filter-options">
            <% ['Red','Blue','Green','Black','White'].forEach(c => { %>
              <div><input type="radio" name="color" value="<%= c %>" <%= selected.color===c?'checked':'' %>> <%= c %></div>
            <% }) %>
          </div>
        </div>

        <div class="filter-section mb-3">
          <h6>Price <i class="bi bi-chevron-down"></i></h6>
          <div class="filter-options">
            <input type="number" name="minPrice" placeholder="Min" class="form-control mb-2" value="<%= selected.minPrice || '' %>">
            <input type="number" name="maxPrice" placeholder="Max" class="form-control mb-2" value="<%= selected.maxPrice || '' %>">
          </div>
        </div>

        <button class="btn btn-danger btn-sm w-100 mb-2">Apply Filters</button>
        <a href="/AllProducts" class="btn btn-outline-secondary btn-sm w-100">Clear All</a>

      </form>
    </div>

    <div class="col-md-9">

      <div class="filter-bar mb-4 d-flex gap-3">

        <div class="dropdown">
          <button class="btn filter-btn active dropdown-toggle" data-bs-toggle="dropdown">
            All Products
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="/AllProducts">All Products</a></li>
          </ul>
        </div>

        <div class="dropdown">
          <button class="btn filter-btn dropdown-toggle" data-bs-toggle="dropdown">
            Category
          </button>
          <ul class="dropdown-menu">
            <% categories.forEach(cat => { %>
              <li>
                <a class="dropdown-item" href="/AllProducts?category=<%= cat._id %>">
                  <%= cat.name %>
                </a>
              </li>
            <% }) %>
          </ul>
        </div>

        <div class="dropdown">
          <button class="btn filter-btn dropdown-toggle" data-bs-toggle="dropdown">
            Brand
          </button>
          <ul class="dropdown-menu">
            <% brands.forEach(br => { %>
              <li>
                <a class="dropdown-item" href="/AllProducts?brand=<%= br._id %>">
                  <%= br.brandName %>
                </a>
              </li>
            <% }) %>
          </ul>
        </div>

   </div>
<div class="row g-4">
  <% products.forEach(product => { %>

    <div class="col-md-4 col-sm-6">
      <div class="product-card">

        <div class="img-box">

          <a class="wishlist-btn"
             href="/wishlist/add/<%= product._id %>"
             onclick="event.stopPropagation()">
            <i class="bi bi-heart"></i>
          </a>

          <img
            src="/uploads/productImages/<%= product.productImage?.[0] || 'no-image.jpg' %>"
            onclick="location.href='/product/<%= product._id %>'"
          >
        </div>

        <div class="product-info">

          <h6 class="product-name">
            <%= product.productName %>
          </h6>
          <p class="brand-name">
            Brand: <strong><%= product.brand?.brandName %></strong>
          </p>

          <div class="rating-box">
            <% 
              const rating = product.averageRating || 4.2;
              const totalStars = 5;
            %>

            <% for(let i = 1; i <= totalStars; i++) { %>
              <% if(i <= Math.floor(rating)) { %>
                <i class="bi bi-star-fill"></i>
              <% } else if(i - rating < 1) { %>
                <i class="bi bi-star-half"></i>
              <% } else { %>
                <i class="bi bi-star"></i>
              <% } %>
            <% } %>

            <span class="rating-text">
              <%= rating %>
            </span>
          </div>
          <div class="price-offer-row">
  <div class="price-box">
    <span class="price">₹<%= product.salesPrice || product.regularPrice %></span>

    <% if(product.productOffer > 0){ %>
      <span class="old-price">₹<%= product.regularPrice %></span>
    <% } %>
  </div>

  <% if(product.productOffer > 0){ %>
    <span class="offer-label-right">
      <%= product.productOffer %>% OFF
    </span>
  <% } %>
</div>

        </div>

      </div>
    </div>

  <% }) %>
</div>


      <nav class="mt-4">
        <ul class="pagination justify-content-center">
          <% if(currentPage > 1){ %>
            <li class="page-item">
              <a class="page-link" href="/AllProducts?page=<%= currentPage-1 %>">«</a>
            </li>
          <% } %>

          <% for(let i=1;i<=totalPages;i++){ %>
            <li class="page-item <%= i===currentPage?'active':'' %>">
              <a class="page-link" href="/AllProducts?page=<%= i %>"><%= i %></a>
            </li>
          <% } %>

          <% if(currentPage < totalPages){ %>
            <li class="page-item">
              <a class="page-link" href="/AllProducts?page=<%= currentPage+1 %>">»</a>
            </li>
          <% } %>
        </ul>
      </nav>

    </div>
  </div>
</div>
<%- include('../../views/partials/user/footer') %>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
 
  document.querySelectorAll('.filter-section h6').forEach(header => {
    header.addEventListener('click', () => {
      header.parentElement.classList.toggle('active');
    });
  });
</script>

</body>
</html>