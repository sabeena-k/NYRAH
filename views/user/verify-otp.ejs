<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
   <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <title>OTP Verification</title>
    <style>
        * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: sans-serif;
}

body {
    background: #ffdfd1;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
}

.otp-container {
    width: 90%;
    height: 500px;
    max-width: 900px;
    background: #ffe5d9;
    border-radius: 16px;
    display: flex;
    padding: 20px;
    gap: 20px;
}

.otp-image-box {
    flex: 3;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;

}

.otp-image-box img {
    width: 100%;
    max-width: 100%;
    height:480px;
}

.otp-form-box {
    flex: 1;
    padding:100px;
   
}

.otp-form-box h2 {
    color: #b33030;
    margin-bottom: 10px;
}

.otp-form-box p {
    margin-bottom: 20px;
    color: #444;
}

.otp-inputs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}

.otp-field {
    width: 50px;
    height: 55px;
    border-radius: 8px;
    border: 2px solid #ffb4a2;
    font-size: 20px;
    text-align: center;
    background: #fff;
}

.resend-section {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 15px;
}

#resendBtn {
    color: #b33030;
    text-decoration: none;
    font-size: 14px;
    background: transparent;
    border: 0;

    cursor: pointer;                
    pointer-events: auto !important; 
    position: relative;             
    z-index: 10;                    
}

.timer {
    font-size: 14px;
    color: #333;
}

.confirm-btn {
    width: 100%;
    background: #d9534f;
    color: white;
    padding: 12px;
    font-size: 16px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
}

.confirm-btn:hover {
    background: #b22e2b;
}

.back-link {
    text-align: center;
    margin-top: 10px;
}

.back-link a {
    color: #333;
    text-decoration: none;
}

@media (max-width: 768px) {
    .otp-container {
        flex-direction: column;
        text-align: center;
    }

    .otp-inputs {
        justify-content: center;
    }
}

    </style>
</head>

<body>

<div class="otp-container">
    <div class="otp-image-box">
        <img src="images/555.jpg" alt="otp-image" />
    </div>
    <div class="otp-form-box">
        <h2>OTP Verification</h2>
        <p>Please check your mail address for OTP</p>

        <form id="otpForm" method="POST" action="/verify-otp"onSubmit="return otpValidateForm()">

            <div class="otp-inputs"id="otp">
                <input type="text" maxlength="1" class="otp-field" />
                <input type="text" maxlength="1" class="otp-field" />
                <input type="text" maxlength="1" class="otp-field" />
                <input type="text" maxlength="1" class="otp-field" />
            </div>

            <div class="resend-section">
            <button type="button" id="resendBtn">Resend OTP</button>
             <span class="timer" id="timer">01:00</span>
              </div>

            <button class="confirm-btn" type="submit">Confirm</button>

            <p class="back-link">
                <a href="/signup">Go back to signup page</a>
            </p>

        </form>
    </div>

</div>

<script>
let timer = 60;
let timerInterval;

const resendBtn = document.getElementById("resendBtn");
const timerDisplay = document.getElementById("timer");
const otpInputs = document.querySelectorAll(".otp-field");

function startTimer() {
  resendBtn.disabled = true;
  resendBtn.style.opacity = "0.5";
  timer = 60;

  timerInterval = setInterval(() => {
    timerDisplay.textContent =
      "00:" + (timer < 10 ? "0" + timer : timer);
    timer--;

    if (timer < 0) {
      clearInterval(timerInterval);
      timerDisplay.textContent = "Expired";
      resendBtn.disabled = false;
      resendBtn.style.opacity = "1";
    }
  }, 1000);
}

startTimer();

resendBtn.addEventListener("click", function () {
  fetch("/resend-otp", { method: "POST" })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        Swal.fire({
          icon: "success",
          title: "OTP resent successfully",
          timer: 1500,
          showConfirmButton: false
        });
        startTimer();
      } else {
        Swal.fire({
          icon: "error",
          title: "Error",
          text: data.message
        });
      }
    });
});

otpInputs.forEach((input, index) => {
  input.addEventListener("input", () => {
    if (input.value && index < otpInputs.length - 1) {
      otpInputs[index + 1].focus();
    }
  });
});

document.getElementById("otpForm").addEventListener("submit", async e => {
  e.preventDefault();

  let otp = "";
  otpInputs.forEach(i => otp += i.value);

  const res = await fetch("/verify-otp", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ otp })
  });

  const data = await res.json();

  if (data.success) {
    window.location.href = data.redirectUrl;
  } else {
    Swal.fire({
      icon: "error",
      title: "Invalid OTP",
      text: data.message
    });
  }
});
</script>
</body>
</html
